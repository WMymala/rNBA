---
title: "Bball Shooting Correlations - 49 Leagues"
author: "Walter Mymala"
date: "8/9/2021"
output: html_document
---

** Dataset from Jacob Baruch on Kaggle.com:https://www.kaggle.com/jacobbaruch/basketball-players-stats-per-season-49-leagues 

Dataset Information:

Contains stats scraped from 49 basketball leagues from around the world 
from 1990 to 2020**

The purpose of this study is to see if the shooting fundamentals are held to the highest standard for each league and each time period in basketball. It tends to be a lithmus test for one's ability to be able to shoot the basketball in general; people look at college players's free throw percentage to judge their shooting potential for the professional game.

```{r, results = 'hide', echo = FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(knitr)
library(ggrepel)

D <- read.csv("~/Desktop/MoneyBall/players_stats_by_season_full_details.csv")

D$FGPct = D$FGM / D$FGA # include FG% in dataset and order it in column neatly
D$FTPct = D$FTM / D$FTA # include FT% ...
D$X3Pct = D$X3PM / D$X3PA # include X3P% ...

# I manually add in new variables to dataset in order that I want instead of the end. There's got to be a better way to do this...
D = D %>% select(League, Season, Stage, Player, Team, GP, MIN, FGM, FGA, FGPct, X3PM, X3PA, X3Pct, FTM, FTA, FTPct, TOV, PF, ORB, DRB, REB, AST, STL, BLK, PTS, birth_date, birth_year, birth_month, height, height_cm, weight, weight_kg, nationality, high_school,  draft_round, draft_pick, draft_team)
```

```{r}
# Displays the first 6 rows of dataset D
head(D)
```

```{r}
# Extract all the available basketball leagues in the dataset
unique(D$League, incomparables = FALSE)
```

**The Euroleague and Eurocup is bascally like soccer's Champions League and Europa League in that it consists of having top European teams playing one another. These teams play in these respective leagues as well as their own domestic league concurrently. This may affect the data.**

** The European professional club basketball system starting in 2018**

From MrThirteenXIII from Reddit(https://www.reddit.com/r/Euroleague/comments/hiolt2/how_are_euroleague_teams_selected/):
13 teams have a contract and they participate no matter what. These teams are Real Madrid(ESP), Barcelona(ESP), Baskonia(ESP), Olimpia Milano(ITA), Zalgiris(LTU), Panathinaikos(GRC), Olympiacos(GRC), Panathinaikos(GRC), Fenerbahce(TUR), Anadolu Efes(TUR), CSKA Moscow(RUS), LDLC ASVEL(FRA) and Maccabi Tel Aviv(ISR).

The 7 spots left :

The winner of eurocup (second tier European competition)

The winner of ABA league (league based on former countries of Yuguslavia: Bosnia and Herzegovina, Croatia, Macedonia, Montenegro, Serbia (including the regions of Kosovo and Vojvodina) and Slovenia)

The winner or runner up of VTB(Russian) league (usually CSKA wins, so the second team from VTB)

wildcard places lasting 2-years or 1-year

The winner of BBL (German league).

```{r}

# subset from dataframe just the NBA in 2019-2020 regular season with statistical minimums to qualify for NBA League Leaders to limit outliers: 

NBA19_20R <- D %>% filter(League == "NBA", Season == "2019 - 2020", FTA >= 125) # observations drop from 360 to 125 after adding statistical minimum
head(NBA19_20R)

# scatterplot w/o using ggplot
plot(NBA19_20R$X3Pct, NBA19_20R$FTPct, xlab = '3 Point %', ylab = 'Free Throw %')
```

From our data, ignoring the outliers near 0.0 3 point % and 0.6 3 point %, there is no clear pattern to indicate relationship between 3 point % and free throw %. Let's do a scatterplot, but with ggplot. 

```{r}
## subset dataframe of the second best league in the 2019-2020 regular season according to ESPN with statistical minimums to qualify for Leagues Leaders(Euroleague players must play 51% of games to be in league leaders, so 34 • .51 = 17.34 is 18 games minimum)

EuroL19_20R <- D %>% filter(League == "Euroleague", Season == "2019 - 2020", GP >= 18)
# observations drop from 237 to 183 after adding statistical minimum

NBAxEuroL19_20R <- rbind(NBA19_20R, EuroL19_20R) # merge data
```


```{r}
## working w/ ggplots now: scatterplot
ggplot(NBAxEuroL19_20R, aes(x = X3Pct, y = FTPct, col = League)) + geom_point()
```

```{r, warning = FALSE}
# I also want to represent points by mapping so the individual dots change depending on the PTS variable(Note: NBA plays more games than Euroleague). I also isolated NBA player Andre Drummond's point on the data since he scores a lot of points but is a notorius free throw shooter

plot <- ggplot(NBAxEuroL19_20R, aes(x = X3Pct, y = FTPct, col = League, size = PTS)) + geom_point(shape = ifelse(NBAxEuroL19_20R$Player == "Andre Drummond", 18, 20)) + scale_color_manual(values = c("NBA" = "blue", "Euroleague" = "orange")) + geom_smooth(method = lm, se = FALSE) + 
  geom_text_repel(label = ifelse(NBAxEuroL19_20R$Player == "Andre Drummond", "Andre Drummond", ""), nudge_x = -.05,
    box.padding = 0.5,
    nudge_y = -0.2,
    segment.curvature = -0.1,
    segment.ncp = 3,
    segment.angle = 0) 

plot
```

```{r}
cor(NBAxEuroL19_20R$X3Pct, NBAxEuroL19_20R$FTPct)
```

The scatter plot data shows no apparent relationship between 3-point shooting and free throw percentage since there is no linear pattern. Due to this, the regression line might not have any use here. We can tell since the correlation between the two functions is N/A.


```{r echo = F, results = 'hide'}
## ggplot practice
# map FTPct to transparency of each point
## ggplot(NBAxEuroL19_20R) + geom_point(aes(x = X3Pct, y = FTPct, col = League, size = PTS, shape = League, alpha = FTPct)) + scale_color_manual(values = c("NBA" = "blue", "Euroleague" = "orange"))

## ggplot(NBAxEuroL19_20R, aes(x = FTPct)) + 
## geom_histogram(bins = 30) + geom_histogram(color="black", fill="white") 
```

In this part of the study, I want to compare free throw percentage between the NBA and Eurolegue in the 2019 - 2020 season by making separate charts for side-by side comparisons by making separate charts.

```{r}
# histogram - overlaid and separated by league

ggplot(NBAxEuroL19_20R, aes(x = FTPct, fill = League, color = League)) +
  geom_histogram(alpha = 0.4, position = "identity") + scale_color_manual(values=c("orange", "blue")) +
  theme(legend.position="bottom") 

# density chart
ggplot(data = NBAxEuroL19_20R, aes(x = FTPct, group = League, fill = League)) + geom_density(adjust = 1.5, alpha = .4) + scale_fill_manual(values=c("orange", "blue")) + theme(legend.position="bottom")

```

It seems like histograms along with it's density plots are the best way to display comparisons for free throw shooting information between groups.

Based on the histogram, the Euroleague and NBA seem to have the same amount of free throw percentage rates.

In this part of the study, I want to compare free throw percentage between years in the NBA to see if there are any drastic changes since the way basketball has been played has changed from the past decades until now. I want to now compare just the NBA between eras by making summary tables and density charts for side-by side comparisons between the eras and seasons within them since comparing  decade by decade isn't very accurate. I used WinesburgOhio's post on Reddit as reference to when certain eras are in the NBA. (https://www.reddit.com/r/nbadiscussion/comments/khl4zh/eras_in_nba_history_when_do_they_beginend_and_why/). 

```{r}
NBA <- D %>% filter(League == "NBA")
```

Eras(Summarized):

• '93-'03: Jordan Era. Dead ball era—slower paced games and more defensive minded. 3 point shooting starting to be utilized more.

• '04-'13: Kobe Era. Pace picked back up, 3 point shooting up more, more individual NBA talent than before.

• '14-Present: Curry/3-point era. Pace increased, 3-point shooting increased considerably, positionless basketball, defense harder to play b/c refs(ticky-tack fouls), analytics to judge players.


Important rule changes that may affect free throw percentages(from https://www.deseret.com/2019/2/21/20666425/nba-rules-have-adapted-over-the-years-to-make-the-game-more-fun-for-players-fans):

• 2001 — "Illegal defense eliminated and zone defense allowed. Defensive 3-second rule prohibits defensive player from being in lane without guarding offensive player" (Sorenson, DeseretNews)

• 2018 — "Shot clock reset to 14 after an offensive rebound rather than 24" (Sorenson, DeseretNews)

I wanted to create summary table first to see if there were any major differences from a glance of the between the ranges  of the 1st and 3rd quantiles.

```{r echo = F}
Yr99_00 <- D %>% filter(League == "NBA", Season == "1999 - 2000") %>% select(FTPct) %>% summary() 
Yr00_01 <- D %>% filter(League == "NBA", Season == "2000 - 2001") %>% select(FTPct) %>% summary()
Yr01_02 <- D %>% filter(League == "NBA", Season == "2001 - 2002") %>% select(FTPct) %>% summary()
Yr02_03 <- D %>% filter(League == "NBA", Season == "2002 - 2003") %>% select(FTPct) %>% summary()

JordanEraData <- data.frame(Yr99_00[1:6], Yr00_01[1:6], Yr01_02[1:6], Yr02_03[1:6])
colnames(JordanEraData) <- c("99-00", "00-01", "01-02", "02-03")

require(pander)
pandoc.table(JordanEraData, style = 'grid', caption = "Jordan Era('93-'03)")
```

Seems like the quartiles and medians are similar to each other through the years.

```{r echo = F, results = 'hide'}
# count how many datapoints for each one season(Jordan era)
D %>% filter(League == "NBA", Season == "1999 - 2000") %>% count # 342
D %>% filter(League == "NBA", Season == "2000 - 2001") %>% count # 315
D %>% filter(League == "NBA", Season == "2001 - 2002") %>% count # 319
D %>% filter(League == "NBA", Season == "2002 - 2003") %>% count # 364
```

```{r echo = F, , message = FALSE, warning = FALSE}
JordanEra = subset(NBA, Season == "1999 - 2000" | Season == "2000 - 2001" | Season == "2001 - 2002" | Season == "2002 - 2003")
# Jordan Era histogram
ggplot(JordanEra, aes(x = FTPct, fill = Season)) + geom_histogram(alpha = 0.7, position = "dodge") + scale_fill_manual(labels = c("1999 - 2000", "2000 - 2001","2001 - 2002","2002 - 2003"), values=c("black", "seagreen", "coral", "yellow")) 
  theme(legend.position="bottom") 

# Jordan Era density chart
ggplot(data = JordanEra, aes(x = FTPct, group = Season, fill = Season)) + geom_density(adjust = 1.5, alpha = .4) + scale_fill_manual(values=c("black", "seagreen", "coral", "yellow")) + theme(legend.position="bottom")
```


We can see that the distibution of each season in this era is around the sane with the center of the distributions concentated around 0.80 range.

Looking at the data, the Jordan Era with 4 seasons is way too much. I may stick with 3 each era and pick out which to choose depending on what values are on the summary table for each respective era. The histogram is very cluttered so will stick to the histogram since there will be more seasons for the other eras.


```{r echo = F}
Yr03_04 <- D %>% filter(League == "NBA", Season == "2003 - 2004") %>% select(FTPct) %>% summary() 
Yr04_05 <- D %>% filter(League == "NBA", Season == "2004 - 2005") %>% select(FTPct) %>% summary()
Yr05_06 <- D %>% filter(League == "NBA", Season == "2005 - 2006") %>% select(FTPct) %>% summary()
Yr06_07 <- D %>% filter(League == "NBA", Season == "2006 - 2007") %>% select(FTPct) %>% summary()
Yr07_08 <- D %>% filter(League == "NBA", Season == "2007 - 2008") %>% select(FTPct) %>% summary()
Yr08_09 <- D %>% filter(League == "NBA", Season == "2008 - 2009") %>% select(FTPct) %>% summary()
Yr09_10 <- D %>% filter(League == "NBA", Season == "2009 - 2010") %>% select(FTPct) %>% summary()
Yr10_11 <- D %>% filter(League == "NBA", Season == "2010 - 2011") %>% select(FTPct) %>% summary()
Yr11_12 <- D %>% filter(League == "NBA", Season == "2011 - 2012") %>% select(FTPct) %>% summary()
Yr12_13 <- D %>% filter(League == "NBA", Season == "2012 - 2013") %>% select(FTPct) %>% summary()

KBData <- data.frame(Yr03_04[1:6], Yr04_05[1:6], Yr05_06[1:6], Yr06_07[1:6], Yr07_08[1:6], Yr08_09[1:6], Yr09_10[1:6], Yr10_11[1:6],Yr11_12[1:6], Yr12_13[1:6])
colnames(KBData) <- c("03-04", "04-05", "05-06", "06-07","07_08", "08-09", "09-10", "10-11", "11-12", "12-13")

require(pander)
pandoc.table(KBData, style = 'grid', caption = "Kobe Era('03-'13)")
```

Seems like the 1st quartile in this era is lower than the Jordan era since the Jordan era's were around 0.70 for them. The median is around the same(0.76)

```{r echo = F, results = 'hide'}
# count how many datapoints for each one season (KB era)
D %>% filter(League == "NBA", Season == "2005 - 2006") %>% count # 336
D %>% filter(League == "NBA", Season == "2009 - 2010") %>% count # 349
D %>% filter(League == "NBA", Season == "2011 - 2012") %>% count # 376
```

```{r echo = F, results = 'hide', message = FALSE}
# Seasons used were andomly chosen which seasons were used with R.
KBTDEra = subset(NBA, Season == "2007 - 2008" | Season == "2008 - 2009" | Season == "2011 - 2012")

# Kobe/Duncan Era density chart
ggplot(data = KBTDEra, aes(x = FTPct, group = Season, fill = Season)) + geom_density(adjust = 1.5, alpha = .4) + scale_fill_manual(values=c("black", "seagreen", "coral")) + theme(legend.position="bottom")
```

Other than the 11-12 era(which is inflated becuase the season was shortened due to lockout), the histogram distributions from this era look similar to the Jordan era's.

```{r echo = F, results = 'hide'}
Yr13_14 <- D %>% filter(League == "NBA", Season == "2013 - 2014") %>% select(FTPct) %>% summary() 
Yr14_15 <- D %>% filter(League == "NBA", Season == "2014 - 2015") %>% select(FTPct) %>% summary()
Yr15_16 <- D %>% filter(League == "NBA", Season == "2015 - 2016") %>% select(FTPct) %>% summary()
Yr16_17 <- D %>% filter(League == "NBA", Season == "2016 - 2017") %>% select(FTPct) %>% summary()
Yr17_18 <- D %>% filter(League == "NBA", Season == "2017 - 2018") %>% select(FTPct) %>% summary()
Yr18_19 <- D %>% filter(League == "NBA", Season == "2018 - 2019") %>% select(FTPct) %>% summary()
Yr19_20 <- D %>% filter(League == "NBA", Season == "2019 - 2020") %>% select(FTPct) %>% summary()

KBTDData <- data.frame(Yr13_14[1:6], Yr14_15[1:6], Yr15_16[1:6], Yr16_17[1:6], Yr17_18[1:6], Yr18_19[1:6], Yr19_20[1:6])
colnames(KBTDData) <- c("13_14", "14-15", "15-16", "16-17","17_18", "18-19", "19-20")

require(pander)
pandoc.table(KBTDData, style = 'grid', caption = "3-point era('03-'13)")
```

1st quartile, median and 3rd quartile in this era are similar to the other eras.

```{r echo = F, results = 'hide'}
# count how many datapoints for each one season(3-point era)
D %>% filter(League == "NBA", Season == "2013 - 2014") %>% count # 361
D %>% filter(League == "NBA", Season == "2014 - 2015") %>% count # 346
D %>% filter(League == "NBA", Season == "2019 - 2020") %>% count # 420
```

```{r, message = FALSE}
# Seasons used were andomly chosen which seasons were used with R.
ModernEra = subset(NBA, Season == "2013 - 2014" | Season == "2014 - 2015" | Season == "2019 - 2020")

# Kobe/Duncan Era density chart
ggplot(data = ModernEra, aes(x = FTPct, group = Season, fill = Season)) + geom_density(adjust = 1.5, alpha = .4) + scale_fill_manual(values=c("black", "seagreen", "coral")) + theme(legend.position="bottom")
```

Teams played 71–75 games(COVID) during the 2019-2020 season, the histogram distributions from this era look similar to the Jordan era's. Other than the shortened season, the  histogram distributions from this era look similar to the other 2 eras since center is condensed around the 75%-80% free throw range.

<p style="text-align: center;"><br />_____________________________________________________</p>
<p style="text-align: center;"><strong>APPENDIX</strong></p>
<p style="text-align: center;">____________________________________________________</p>
<p style="text-align: center;">R Code used listed below.</p>

```{r, ref.label=knitr::all_labels(),echo=TRUE,eval=FALSE}

```


