---
title: "Bball Shooting Correlations - 49 Leagues"
author: "Walter Mymala"
date: "8/9/2021"
output: html_document
---

** Dataset from Jacob Baruch on Kaggle.com:https://www.kaggle.com/jacobbaruch/basketball-players-stats-per-season-49-leagues 

Contains stats scraped from 49 basketball leagues from around the world 
from 1990 to 2020**

The purpose of this study is to see if the shooting fundamentals are held to the highest standard for each league and each time period in basketball. It tends to be a lithmus test for one's ability to be able to shoot the basketball in general; people look at college players's free throw percentage to judge their shooting potential for the professional game.

```{r results = 'hide'}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(knitr)
library(ggrepel)

D <- read.csv("~/Desktop/MoneyBall/players_stats_by_season_full_details.csv")

D$FGPct = D$FGM / D$FGA # include FG% in dataset and order it in column neatly
D$FTPct = D$FTM / D$FTA # include FT% ...
D$X3Pct = D$X3PM / D$X3PA # include X3P% ...

# manually add in new variables to dataset in order that I want instead of the end. There's got to be a better way to do this...
D = D %>% select(League, Season, Stage, Player, Team, GP, MIN, FGM, FGA, FGPct, X3PM, X3PA, X3Pct, FTM, FTA, FTPct, TOV, PF, ORB, DRB, REB, AST, STL, BLK, PTS, birth_date, birth_year, birth_month, height, height_cm, weight, weight_kg, nationality, high_school,  draft_round, draft_pick, draft_team)
```

```{r}
# displays first 6 rows of dataset
head(D)
```


```{r}
# extract all basketball leagues that are in the dataset
unique(D$League, incomparables = FALSE)
```

**The Euroleague and Eurocup is bascally like soccer's Champions League and Europa League in that it consists of having top European teams playing one another. These teams play in these respective leagues as well as their own domestic league concurrently. This may affect the data.**

** The European professional club basketball system starting in 2018**

From MrThirteenXIII from Reddit(https://www.reddit.com/r/Euroleague/comments/hiolt2/how_are_euroleague_teams_selected/):
13 teams have a contract and they participate no matter what. These teams are Real Madrid(ESP), Barcelona(ESP), Baskonia(ESP), Olimpia Milano(ITA), Zalgiris(LTU), Panathinaikos(GRC), Olympiacos(GRC), Panathinaikos(GRC), Fenerbahce(TUR), Anadolu Efes(TUR), CSKA Moscow(RUS), LDLC ASVEL(FRA) and Maccabi Tel Aviv(ISR).

The 7 spots left :

The winner of eurocup (second tier European competition)

The winner of ABA league (league based on former countries of Yuguslavia: Bosnia and Herzegovina, Croatia, Macedonia, Montenegro, Serbia (including the regions of Kosovo and Vojvodina) and Slovenia)

The winner or runner up of VTB(Russian) league (usually CSKA wins, so the second team from VTB)

wildcard places lasting 2-years or 1-year

The winner of BBL ( German league).

```{r}
# subset from dataframe just the NBA in 2019-2020 regular season with statistical minimums to qualify for NBA League Leaders to limit outliers: 

NBA19_20R <- D %>% filter(League == "NBA", Season == "2019 - 2020", FTA >= 125) # observations drop from 360 to 125 after adding statistical minimum
head(NBA19_20R)

# scatterplot w/o using ggplot
plot(NBA19_20R$X3Pct, NBA19_20R$FTPct, xlab = '3 Point %', ylab = 'Free Throw %')
```

From our data, ignoring the outliers near 0.0 3 point % and 0.6 3 point %, there is no clear pattern to indicate relationship between 3 point % and free throw %. Let's do a scatterplot, but with ggplot. 

```{r}
## subset dataframe of the second best league in the 2019-2020 regular season according to ESPN with statistical minimums to qualify for Leagues Leaders(Euroleague players must play 51% of games to be in league leaders, so 34 • .51 = 17.34 is 18 games minimum)

EuroL19_20R <- D %>% filter(League == "Euroleague", Season == "2019 - 2020", GP >= 18)
# observations drop from 237 to 183 after adding statistical minimum

NBAxEuroL19_20R <- rbind(NBA19_20R, EuroL19_20R) # merge data
```


```{r}
## working w/ ggplots now: scatterplot
ggplot(NBAxEuroL19_20R, aes(x = X3Pct, y = FTPct, col = League)) + geom_point() 
```
```{r}
# also want to represent points by mapping so individual dot changes depending on PTS variable(NBA plays more games than Euroleague)

# Let's just label these items.
ix_label <- c("Ben Simmons", "Kyle Kuzma")

plot <- ggplot(NBAxEuroL19_20R, aes(x = X3Pct, y = FTPct, col = League, size = PTS)) + geom_point(shape = ifelse(NBAxEuroL19_20R$Player == "Andre Drummond", 18, 20)) + scale_color_manual(values = c("NBA" = "blue", "Euroleague" = "orange")) + geom_smooth(method = lm, se = FALSE) + 
  geom_text_repel(label = ifelse(NBAxEuroL19_20R$Player == "Andre Drummond", "Andre Drummond", ""), nudge_x = -.05,
    box.padding = 0.5,
    nudge_y = -0.2,
    segment.curvature = -0.1,
    segment.ncp = 3,
    segment.angle = 0) 

plot

cor(NBAxEuroL19_20R$X3Pct, NBAxEuroL19_20R$FTPct)
```

The scatter plot data shows no apparent relationship between 3-point shooting and free throw percentage since there is no linear pattern. Due to this, the regression line might not have any use here. We can tell since the correlation between the two functions is N/A.

```{r echo = F, results = 'hide'}
## ggplot practice
# map FTPct to transparency of each point
## ggplot(NBAxEuroL19_20R) + geom_point(aes(x = X3Pct, y = FTPct, col = League, size = PTS, shape = League, alpha = FTPct)) + scale_color_manual(values = c("NBA" = "blue", "Euroleague" = "orange"))

## ggplot(NBAxEuroL19_20R, aes(x = FTPct)) + 
## geom_histogram(bins = 30) + geom_histogram(color="black", fill="white") 
```

```{r}
# histogram - overlaid and separated by league

ggplot(NBAxEuroL19_20R, aes(x = FTPct, fill = League, color = League)) +
  geom_histogram(alpha = 0.4, position = "identity") + scale_color_manual(values=c("orange", "blue")) +
  theme(legend.position="bottom") 

# density chart
ggplot(data = NBAxEuroL19_20R, aes(x = FTPct, group = League, fill = League)) + geom_density(adjust = 1.5, alpha = .4) + scale_fill_manual(values=c("orange", "blue")) + theme(legend.position="bottom")

```

It seems like histograms along with it's density plots are the best way to display comparisons for free throw shooting information between groups.

Based on the histogram, the Euroleague and NBA seem to have the same amount of free throw percentage rates.

I want to now compare just the NBA between eras by making separate charts for side-by side comparisons between the eras and seasons within the eras. I could compare the decade by decade, but that isn't very accurate. I used WinesburgOhio's post on Reddit as reference to decide.(https://www.reddit.com/r/nbadiscussion/comments/khl4zh/eras_in_nba_history_when_do_they_beginend_and_why/). Our data has provided information for 3 eras in NBA basketball.

```{r}
NBA <- D %>% filter(League == "NBA")
```

Eras(Summarized):

• '93-'03: Jordan Era. Dead ball era—slower paced games and more defensive minded. 3 point shooting starting to be utilized more.

• '04-'13: Kobe/Duncan Era. Pace picked back up, 3 point shooting up more, more individual NBA talent than before.

• '14-Present: Curry/3-point era. Pace increased, 3-point shooting increased considerably, positionless basketball, defense harder to play b/c refs(ticky-tack fouls), analytics to judge players.


Important rule changes that may affect free throw percentages(from https://www.deseret.com/2019/2/21/20666425/nba-rules-have-adapted-over-the-years-to-make-the-game-more-fun-for-players-fans):

• 2001 — "Illegal defense eliminated and zone defense allowed. Defensive 3-second rule prohibits defensive player from being in lane without guarding offensive player" (Sorenson, DeseretNews)

• 2018 — "Shot clock reset to 14 after an offensive rebound rather than 24" (Sorenson, DeseretNews)

I wanted to create summary table first to see if there were any major differences from a glance of the between the ranges  of the 1st and 3rd quantiles.

```{r}
Yr99_00 <- D %>% filter(League == "NBA", Season == "1999 - 2000") %>% select(FTPct) %>% summary() 
Yr00_01 <- D %>% filter(League == "NBA", Season == "2000 - 2001") %>% select(FTPct) %>% summary()
Yr01_02 <- D %>% filter(League == "NBA", Season == "2001 - 2002") %>% select(FTPct) %>% summary()
Yr02_03 <- D %>% filter(League == "NBA", Season == "2002 - 2003") %>% select(FTPct) %>% summary()

JordanEraData <- data.frame(Yr99_00[1:6], Yr00_01[1:6], Yr01_02[1:6], Yr02_03[1:6])
colnames(JordanEraData) <- c("99-00", "00-01", "01-02", "02-03")

require(pander)
pandoc.table(JordanEraData, style = 'grid', caption = "Jordan Era('93-'03)")
```

```{r}
# Jordan Era histogram

# count how many datapoints for each one season
D %>% filter(League == "NBA", Season == "1999 - 2000") %>% count # 342
D %>% filter(League == "NBA", Season == "2000 - 2001") %>% count # 315
D %>% filter(League == "NBA", Season == "2001 - 2002") %>% count # 319
D %>% filter(League == "NBA", Season == "2002 - 2003") %>% count # 364

JordanEra = subset(NBA, Season == "1999 - 2000" | Season == "2000 - 2001" | Season == "2001 - 2002" | Season == "2002 - 2003")
ggplot(JordanEra, aes(x = FTPct, fill = Season)) + geom_histogram(alpha = 0.7, position = "dodge") + scale_fill_manual(labels = c("1999 - 2000", "2000 - 2001","2001 - 2002","2002 - 2003"), values=c("black", "seagreen", "coral", "yellow")) 
  theme(legend.position="bottom") 

# Jordan Era density chart
ggplot(data = JordanEra, aes(x = FTPct, group = Season, fill = Season)) + geom_density(adjust = 1.5, alpha = .4) + scale_fill_manual(values=c("black", "seagreen", "coral", "yellow")) + theme(legend.position="bottom")
```


We can see that the distibution of each season in this era is around the sane with the center of the distributions concentated around 0.80 range.

Looking at the data, the Jordan Era with 4 seasons is way too much. I may stick with 3 each era(close to the beginning—2 years into era, in the middle, and end—second to last year of era) so it's not so cluttered. 

```{r}
# Kobe/Duncan Era era histogram

# count how many datapoints for each one season
D %>% filter(League == "NBA", Season == "2005 - 2006") %>% count # 336
D %>% filter(League == "NBA", Season == "2009 - 2010") %>% count # 349
D %>% filter(League == "NBA", Season == "2011 - 2012") %>% count # 376

KBDuncEra = subset(NBA, Season == "2005 - 2006" | Season == "2009 - 2010" | Season == "2011 - 2012")
ggplot(KBDuncEra, aes(x = FTPct, fill = Season)) + geom_histogram(alpha = 1, position = "dodge") + scale_fill_manual(labels = c("2005 - 2006", "2009 - 2010","2011 - 2012"), values=c("black", "seagreen", "coral")) 
  theme(legend.position="bottom") 
  
# Jordan Era density chart
ggplot(data = KBDuncEra, aes(x = FTPct, group = Season, fill = Season)) + geom_density(adjust = 1.5, alpha = .4) + scale_fill_manual(values=c("black", "seagreen", "coral")) + theme(legend.position="bottom")
```

The distribution of free throw percentage in the 2011-2012 season(center at ~) is visibily higher by a slight margin compared to the 2005 - 2006 season and 2009 - 2010.


